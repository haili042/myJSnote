<!DOCTYPE html>
<html>
<head lang="en">

    <!-- META -->
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- END META -->

    <title>my bootstrap frame</title>

    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="../bootstrap/css/bootstrap.css">
    <link rel="stylesheet" type="text/css" href="../bootstrap/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="../bootstrap/css/design.css">
    <!-- END CSS -->

    <!-- SCRIPT -->
    <script src="../script/jquery.min.js"></script>
    <script src="../bootstrap/js/bootstrap.js"></script>
    <script src="../script/utilTools.js"></script>
    <!-- END SCRIPT -->

</head>

<body>

<header>
    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
        <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
                        data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>

                <div class="brand">
                    <a class="navbar-brand" href="http://www.solutiisoft.com/bootstrap-sidebar/index.php"><span>bootstrap sidebar</span></a>
                    <a class="toogle pull-right"><i class="fa fa-chevron-left"></i></a>
                </div>
            </div>

            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <form class="navbar-form navbar-left" role="search">
                    <div class="form-group">
                        <select class="form-control solsoThemeEvent">
                            <option value="" selected="">choose</option>
                            <option value="blue">blue theme</option>
                            <option value="orange">orange theme</option>
                        </select>
                    </div>
                </form>
            </div>
        </div>
    </nav>
</header>

<div class="body slide">
    <aside class="sidebar show perfectScrollbar">
        <div id="solso-sidebar">
            <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">

                <div class="panel panel-default">
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="heading1">
                            <h4 class="panel-title">
                                <a href="" class="single-item">
                                    <i class="fa fa-dashboard"></i> home
                                </a>
                            </h4>
                        </div>
                    </div>
                </div>

                <div class="panel panel-default">

                    <div class="panel-heading" role="tab" id="heading0">
                        <h4 class="panel-title">
                            <a data-toggle="collapse" data-parent="#accordion"
                               href="#collapse0"
                               aria-expanded="true" aria-controls="collapse0">
                                <i class="fa fa-bar-chart-o"></i>$name$
                                <i class="pull-right fa fa-caret-down"></i>
                            </a>
                        </h4>
                    </div>

                    <div id="collapse0" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading0">
                        <div>
                            <a href="" class="list-group-item">123</a>
                            <a href="" class="list-group-item">123</a>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </aside>
</div>

<!-- 模版<i class="fa fa-bar-chart-o"></i>with($name$){for($name.sex$){$name.sex.name$}} -->
<script type="text/html" id="menuTemplate">
    <div class="panel panel-default">

        <div class="panel-heading" role="tab" id="heading$index$">
            <h4 class="panel-title">
                <a data-toggle="collapse" data-parent="#accordion"
                   href="$url$#collapse$index$"
                   aria-expanded="true" aria-controls="collapse$index$">
                    <i class="fa fa-bar-chart-o"></i>with
                    <i class="pull-right fa fa-caret-down"></i>
                </a>
            </h4>
        </div>

        for($menus$){
        <div id="collapse$index$" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading$index$">
            <div>
                for($menus.menus$){<a href="$menus.menus.url$" class="list-group-item">$menus.menus.url$</a>}
            </div>
        </div>
        }

    </div>
</script>
<!-- END 模版 -->
<script>


    // 模版替换
    function replaceTemplate1(template, obj) {
        var bracketStack = [];
        return template.replace(/\$\w+\$|for\s*\(\s*\$.+\$\s*\)\s*\{[^{}]*\}|with\s*\(\s*\$.+\$\s*\)\s*\{[^{}]*\}/gi, function(matchs) {
            var key, keyArr = [],
                i, len, temp = obj,
                newTemplate = "",result = "";

            if (matchs.charAt(0) == "$") {
                key = matchs.replace(/\$/gi, "");
                return (obj[key] || "") + "";
            } else if (matchs.substr(0, 3) === "for") {
                key = matchs.match(/for\(\$\w+\$\)/i)[0].replace(/for|\(|\)|\$/gi, "");
                newTemplate = matchs.match(/\{.+\}/gi)[0].replace(/\{|\}/gi, "");

                if (typeof obj[key] === "undefined") {
                    return "";
                }
                for(i = 0, len = obj[key].length; i < len; i++) {
                    result += replaceTemplate(newTemplate, obj[key][i]) + "\n";
                }
                return result;
            } else if (matchs.substr(0, 4) === "with") {
                key = matchs.match(/with\(\$\w+\$\)/i)[0].replace(/with|\(|\)|\$/gi, "");
                keyArr = key.split(".");
                newTemplate = matchs.match(/\{.+\}/gi)[0].replace(/\{|\}/gi, "");

                for (i = 0, len = keyArr.length; i < len; i++) {
                    result = temp[keyArr[i]];
                    temp = result;
                    if (typeof result === "undefined") {
                        return "";
                    }
                }
                return result;
            }
        });
    }

    function replaceTemplate2(template, obj) {
        return template.replace(/\$\w+\$/gi, function(matchs) {
            var key = matchs.replace(/\$/gi, "");
            return (obj[key] || "") + "";
        });
    }

    function replaceTemplate(template, obj, index) {
        var parttern = /\$[.\w]+\$|for\s*\(\s*\$[.\w]+\$\s*\)\s*\{[^{}]*\}|with\s*\(\s*\$[.\w]+\$\s*\)\s*\{[^{}]*\}/gi;


        do {

            template = template.replace(parttern,
                    function (matchs) {
                        var key, keyArr = [], objArr = [],
                                i, len, temp = obj,
                                newTemplate = "", result = "";

                        if (matchs.charAt(0) == "$") {
                            key = matchs.replace(/\$/gi, "");
                            return (obj[key] || "") + "";
                        } else if (matchs.substr(0, 3) === "for") {
                            key = matchs.match(/for\s*\(\s*\$[.\w]+\$\s*\)/i)[0].replace(/for|\(|\)|\$|\s/gi, "");
                            keyArr = key.split(".");
                            newTemplate = matchs.match(/\{.+\}/gi)[0].replace(/\{|\}/gi, "").replace(key + ".", "");

                            for (i = 0, len = keyArr.length; i < len; i++) {
                                try {
                                    objArr = temp[keyArr[i]];
                                    temp = objArr;
                                    if (objArr instanceof Array) {
                                        for (i = 0, len = objArr.length; i < len; i++) {
                                            result += replaceTemplate(newTemplate, objArr[i]) + "\n";
                                        }
                                    }
                                } catch (e) {
                                    console.log(e);
                                    return "";
                                }
                            }

                            return result;

                        } else if (matchs.substr(0, 4) === "with") {
                            key = matchs.match(/with\s*\(\s*\$[.\w]+\$\s*\)/i)[0].replace(/with|\(|\)|\$|\s/gi, "");
                            keyArr = key.split(".");
                            newTemplate = matchs.match(/\{.+\}/gi)[0].replace(/\{|\}/gi, "");

                            for (i = 0, len = keyArr.length; i < len; i++) {
                                try {
                                    result = temp[keyArr[i]];
                                    temp = result;
                                } catch (e) {
                                    console.log(e);
                                    return "";
                                }
                            }
                            if (result instanceof Array) {

                            }
                            return result;
                        }
                    } // end function(matchs)
            ); // end return

        } while(parttern.test(template));
        return template;
    }

    function getKey(keyStr, obj) {
        var i, len, temp = obj, keyArr = keyStr.split(".");
        for (i = 0, len = keyArr.length; i < len; i++) {
            try {
                objArr = obj[keyArr[i]];
                obj = objArr;
            } catch (e) {
                console.log(e);
                return "";
            }
        }
        return result;
    }

    $.ajax({
        url: "my_menu_data.json",
        success: function(data) {
            var i, len = data.length,
                index = 1,
                template = $("#menuTemplate").text();

            for(i = 0; i < len; i++) {
                data[i].index = index;
                $("#accordion").append( replaceTemplate(template, data[i]) );
                index++;
            }

        }
    });
</script>

</body>
</html>